function completely(e,t){function o(e){return void 0===y&&(y=document.createElement("span"),y.style.visibility="hidden",y.style.position="fixed",y.style.outline="0",y.style.margin="0",y.style.padding="0",y.style.border="0",y.style.left="0",y.style.whiteSpace="pre",y.style.fontSize=t.fontSize,y.style.fontFamily=t.fontFamily,y.style.fontWeight="normal",document.body.appendChild(y)),y.innerHTML=String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),y.getBoundingClientRect().right}t=t||{},t.fontSize=t.fontSize||"16px",t.fontFamily=t.fontFamily||"sans-serif",t.promptInnerHTML=t.promptInnerHTML||"",t.color=t.color||"#333",t.hintColor=t.hintColor||"#aaa",t.backgroundColor=t.backgroundColor||"#fff",t.dropDownBorderColor=t.dropDownBorderColor||"#aaa",t.dropDownZIndex=t.dropDownZIndex||"100",t.dropDownOnHoverBackgroundColor=t.dropDownOnHoverBackgroundColor||"#ddd",t.ignoreCase=t.ignoreCase||!1;var n=document.createElement("input");n.type="text",n.spellcheck=!1,n.style.fontSize=t.fontSize,n.style.fontFamily=t.fontFamily,n.style.color=t.color,n.style.backgroundColor=t.backgroundColor,n.style.width="100%",n.style.outline="0",n.style.border="0",n.style.margin="0",n.style.padding="0";var l=n.cloneNode();l.disabled="",l.style.position="absolute",l.style.top="0",l.style.left="0",l.style.borderColor="transparent",l.style.boxShadow="none",l.style.color=t.hintColor,n.style.backgroundColor="transparent",n.style.verticalAlign="top",n.style.position="relative";var i=document.createElement("div");i.style.position="relative",i.style.outline="0",i.style.border="0",i.style.margin="0",i.style.padding="0";var r=document.createElement("div");if(r.style.position="absolute",r.style.outline="0",r.style.margin="0",r.style.padding="0",r.style.border="0",r.style.fontSize=t.fontSize,r.style.fontFamily=t.fontFamily,r.style.color=t.color,r.style.backgroundColor=t.backgroundColor,r.style.top="0",r.style.left="0",r.style.overflow="hidden",r.innerHTML=t.promptInnerHTML,r.style.background="transparent",void 0===document.body)throw"document.body is undefined. The library was wired up incorrectly.";document.body.appendChild(r);var a=r.getBoundingClientRect().right;i.appendChild(r),r.style.visibility="visible",r.style.left="-"+a+"px",i.style.marginLeft=a+"px",i.appendChild(l),i.appendChild(n);var s=document.createElement("div");s.style.position="absolute",s.style.visibility="hidden",s.style.outline="0",s.style.margin="0",s.style.padding="0",s.style.textAlign="left",s.style.fontSize=t.fontSize,s.style.fontFamily=t.fontFamily,s.style.backgroundColor=t.backgroundColor,s.style.zIndex=t.dropDownZIndex,s.style.cursor="default",s.style.borderStyle="solid",s.style.borderWidth="1px",s.style.borderColor=t.dropDownBorderColor,s.style.overflowX="hidden",s.style.whiteSpace="pre",s.style.overflowY="scroll";var d=function(e){var o=[],n=0,l=-1,i=function(){this.style.outline="1px solid #ddd"},r=function(){this.style.outline="0"},a=function(){s.hide(),s.onmouseselection(this.__hint)},s={hide:function(){e.style.visibility="hidden"},refresh:function(l,d){e.style.visibility="hidden",n=0,e.innerHTML="";var u=window.innerHeight||document.documentElement.clientHeight,y=e.parentNode.getBoundingClientRect(),v=y.top-6,c=u-y.bottom-6;o=[];for(var p=0;p<d.length;p++){if(t.ignoreCase){if(0!==d[p].toLowerCase().indexOf(l.toLowerCase()))continue}else if(0!==d[p].indexOf(l))continue;var f=document.createElement("div");f.style.color=t.color,f.onmouseover=i,f.onmouseout=r,f.onmousedown=a,f.__hint=d[p],f.innerHTML=l+"<b>"+d[p].substring(l.length)+"</b>",o.push(f),e.appendChild(f)}0!==o.length&&(1!==o.length||l!==o[0].__hint)&&(o.length<2||(s.highlight(0),v>3*c?(e.style.maxHeight=v+"px",e.style.top="",e.style.bottom="100%"):(e.style.top="100%",e.style.bottom="",e.style.maxHeight=c+"px"),e.style.visibility="visible"))},highlight:function(e){-1!=l&&o[l]&&(o[l].style.backgroundColor=t.backgroundColor),o[e].style.backgroundColor=t.dropDownOnHoverBackgroundColor,l=e},move:function(t){return"hidden"===e.style.visibility?"":n+t===-1||n+t===o.length?o[n].__hint:(n+=t,s.highlight(n),o[n].__hint)},onmouseselection:function(){}};return s},u=d(s);u.onmouseselection=function(e){n.value=l.value=v+e,p.onChange(n.value),c=n.value,setTimeout(function(){n.focus()},0)},i.appendChild(s),e.appendChild(i);var y,v,c,p={onArrowDown:function(){},onArrowUp:function(){},onEnter:function(){},onTab:function(){},onChange:function(){p.repaint()},startFrom:0,options:[],wrapper:i,input:n,hint:l,dropDown:s,prompt:r,setText:function(e){l.value=e,n.value=e},getText:function(){return n.value},hideDropDown:function(){u.hide()},repaint:function(){var e=n.value,i=p.startFrom,r=p.options,a=r.length,d=e.substring(i);if(v=e.substring(0,i),l.value="",t.ignoreCase)for(var y=0;a>y;y++){var c=r[y];if(0===c.toLowerCase().indexOf(d.toLowerCase())){l.value=v+d+c.substring(d.length);break}}else for(var y=0;a>y;y++){var c=r[y];if(0===c.indexOf(d)){l.value=v+c;break}}s.style.left=o(v)+"px",u.refresh(d,p.options)}},f=function(e,o){c=e.value;var n=function(){var n=e.value;t.ignoreCase?c.toLowerCase()!==n.toLowerCase()&&(c=n,o(n)):c!==n&&(c=n,o(n))};e.addEventListener?(e.addEventListener("input",n,!1),e.addEventListener("keyup",n,!1),e.addEventListener("change",n,!1)):(e.attachEvent("oninput",n),e.attachEvent("onkeyup",n),e.attachEvent("onchange",n))};f(n,function(e){p.onChange(e)});var g=function(e){e=e||window.event;var t=e.keyCode;if(33!=t&&34!=t){if(27==t)return u.hide(),l.value=n.value,void n.focus();if(39!=t&&35!=t&&9!=t)if(13!=t){if(40==t){var o=u.move(1);return""==o&&p.onArrowDown(),void(l.value=v+o)}if(38==t){var o=u.move(-1);return""==o&&p.onArrowUp(),l.value=v+o,e.preventDefault(),void e.stopPropagation()}l.value=""}else if(0==l.value.length)p.onEnter();else{var i="hidden"==s.style.visibility;if(u.hide(),i)return l.value=n.value,n.focus(),void p.onEnter();n.value=l.value;var r=c!=n.value;c=n.value,r&&p.onChange(n.value)}else if(9==t&&(e.preventDefault(),e.stopPropagation(),0==l.value.length&&p.onTab()),l.value.length>0){u.hide(),n.value=l.value;var r=c!=n.value;c=n.value,r&&p.onChange(n.value)}}};return n.addEventListener?n.addEventListener("keydown",g,!1):n.attachEvent("onkeydown",g),p}
